<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canvas Racing Game</title>
<style>
  body {
    margin: 0;
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-family: Arial, sans-serif;
  }
  #gameCanvas {
    background: #444;
    border: 6px solid #fff;
  }
  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 20px;
  }
  #startScreen {
    position: absolute;
    top: 0;
    left: 0;
    right:0;
    bottom:0;
    display:flex;
    background:rgba(0,0,0,0.8);
    flex-direction: column;
    justify-content:center;
    align-items:center;
    font-size:24px;
    z-index:10;
  }
  button {
    padding: 12px 24px;
    font-size: 20px;
    margin-top:20px;
    cursor: pointer;
  }
</style>
</head>

<body>

<div id="startScreen">
  <div>ðŸš— Canvas Racer</div>
  <button onclick="startGame()">Start</button>
</div>

<div id="hud">Score: 0 | Best: 0</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>

// Canvas setup
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const hud = document.getElementById("hud");
const startScreen = document.getElementById("startScreen");

let score = 0;
let bestScore = localStorage.getItem("bestScore") || 0;
let gameOn = false;

// Images
const playerImg = new Image();
playerImg.src = "car.png";

const enemyImg = new Image();
enemyImg.src = "enemy.png";

// Player
let player = { x: 170, y: 500, w: 60, h: 120, speed: 6 };

// Enemies
let enemies = [];
const enemyCount = 3;

// Control
const keys = { ArrowLeft: false, ArrowRight: false };
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// Start
function startGame() {
  gameOn = true;
  score = 0;
  enemies = [];
  startScreen.style.display = "none";
  hud.innerText = `Score: ${score} | Best: ${bestScore}`;
  for (let i = 0; i < enemyCount; i++) {
    enemies.push(createEnemy());
  }
  requestAnimationFrame(gameLoop);
}

// Create Enemy
function createEnemy() {
  return {
    x: Math.random() * 340,
    y: -Math.random() * 600 - 150,
    w: 60,
    h: 120,
    speed: 4 + Math.random() * 3
  };
}

// Game Loop
function gameLoop() {
  if (!gameOn) return;
  
  // Clear
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Move player
  if (keys.ArrowLeft && player.x > 0) player.x -= player.speed;
  if (keys.ArrowRight && player.x < 340) player.x += player.speed;

  // Draw player
  ctx.drawImage(playerImg, player.x, player.y, player.w, player.h);

  // Move & draw enemies
  enemies.forEach((e, i) => {
    e.y += e.speed;
    ctx.drawImage(enemyImg, e.x, e.y, e.w, e.h);

    if (e.y > canvas.height) {
      enemies[i] = createEnemy();
      score++;
      if (score > bestScore) {
        bestScore = score;
        localStorage.setItem("bestScore", bestScore);
      }
    }

    if (detectCollision(player, e)) {
      gameOver();
    }
  });

  hud.innerText = `Score: ${score} | Best: ${bestScore}`;
  requestAnimationFrame(gameLoop);
}

// Collision
function detectCollision(a, b) {
  return !(
    a.y + a.h < b.y ||
    a.y > b.y + b.h ||
    a.x + a.w < b.x ||
    a.x > b.x + b.w
  );
}

// Game Over
function gameOver() {
  gameOn = false;
  startScreen.innerHTML = `
    ðŸš— Game Over<br><br>
    Score: ${score}<br>
    Best: ${bestScore}<br><br>
    <button onclick="startGame()">Restart</button>`;
  startScreen.style.display = "flex";
}

</script>

</body>
</html>
